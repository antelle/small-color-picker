/*! SmallColorPicker v0.1.0  | (c) 2013 Antelle | https://github.com/antelle/SmallColorPicker/blob/master/MIT-LICENSE.txt */
(function(r,o,e,t){"use strict";e.SmallColorPicker=e.SmallColorPicker||{},SmallColorPicker.defaults={placement:{position:"absolute",top:"0",left:"0",parent:null},colors:{colorOld:null,colorNew:"#ff0000"},texts:{ok:"OK",cancel:"Cancel"},behavior:{hideOnSelect:!0},events:{ok:null,cancel:null}},SmallColorPicker.CirclePicker=function(e){function l(){a(),s(),i(),c(),n()}function a(){L={redrawBug:-1!=navigator.userAgent.indexOf("Safari"),borderRadius:"borderRadius"in o.body.style}}function s(){if(!L.borderRadius)throw"Browser is not supported"}function i(){H={},H.el=r("<div></div>").appendTo(I.placement.parent||o.body).addClass("s-c-p").css({position:I.placement.position,left:I.placement.left,top:I.placement.top}),"static"==H.el.css("position")&&H.el.css("position","relative"),H.circle=r("<div></div>").appendTo(H.el).addClass("s-c-p-circle"),H.innerCircle=r("<div></div>").appendTo(H.circle).addClass("s-c-p-circle-inner"),H.circleMark=r("<div></div>").appendTo(H.circle).addClass("s-c-p-circle-mark"),H.square=r("<canvas></canvas>").appendTo(H.el).addClass("s-c-p-square"),H.squareMark=r("<div></div>").appendTo(H.el).addClass("s-c-p-square-mark"),H.square.attr({width:H.square.width(),height:H.square.height()}),H.colorOld=r("<div></div>").appendTo(H.el).addClass("s-c-p-color s-c-p-color-old"),H.colorNew=r("<div></div>").appendTo(H.el).addClass("s-c-p-color s-c-p-color-new"),H.sampleOld=r("<div></div>").appendTo(H.el).addClass("s-c-p-sample s-c-p-sample-old").text(I.texts.cancel),H.sampleNew=r("<div></div>").appendTo(H.el).addClass("s-c-p-sample s-c-p-sample-new").text(I.texts.ok)}function n(){R={globalSelectionMode:r(o.body).css("user-select"),squareWidth:H.square.width(),circleWidth:H.circle.width(),elWidth:H.el.width()}}function c(){H.circle.on("mousedown",h),H.square.on("mousedown",u).on("selectstart",function(r){r.preventDefault()}),H.sampleNew.click(function(){I.behavior.hideOnSelect&&(q(),B=N),I.events.ok&&I.events.ok(N.toHex())}),H.sampleOld.click(function(){I.behavior.hideOnSelect&&q(),I.events.cancel&&I.events.cancel(B.toHex())})}function h(e){p(e.pageX,e.pageY),C(!1),r(o).on("mousemove",m).one("mouseup",f)}function u(e){v(e.pageX,e.pageY),C(!1),r(o).on("mousemove",d).one("mouseup",f)}function m(r){p(r.pageX,r.pageY)}function d(r){v(r.pageX,r.pageY)}function f(){C(!0),r(o).off("mousemove",m).off("mousemove",d)}function p(r,o){var e=H.circle.offset(),t=k(r-e.left,o-e.top);N.hue(t);var l=(new SmallColorPicker.Color).setHsv(t,100,100);P(l.toHex()),w(),M(t),b()}function v(r,o){if(!Y.fw){var e=H.circle.offset(),t=R.circleWidth/2,l=R.squareWidth/2;Y.fw=new SmallColorPicker.Transforms.Translate2D(-e.left-t,-e.top-t).chain(new SmallColorPicker.Transforms.Rotate2D(-X)).chain(new SmallColorPicker.Transforms.Translate2D(l,l))}var a=Y.fw.apply([r,o]);r=Math.max(0,Math.min(R.squareWidth-1,a[0])),o=Math.max(0,Math.min(R.squareWidth-1,a[1])),N=S(r,o),w(),b(r,o)}function C(e){r(o.body).css({webkitUserSelect:e?R.globalSelectionMode:"none"})}function k(r,o){var e=R.circleWidth;r-=e/2,o-=e/2;var t=Math.atan2(r,o);return 180-360*(t/Math.PI/2)}function S(r,o){var e=H.square[0],t=e.getContext("2d"),l=t.getImageData(r,o,1,1).data;return(new SmallColorPicker.Color).setRgb(l[0],l[1],l[2])}function g(){H.colorOld[0].innerHTML=null===B?"":B.toHex(),T(H.sampleOld,null===B?new SmallColorPicker.Color(10066329):B,"old")}function w(){H.colorNew[0].innerHTML=N.toHex(),T(H.sampleNew,N,"new")}function T(r,o,e){var t=o.toHsv().v;r[0].style.backgroundColor=o.toHex(),R.colorSamplesLight||(R.colorSamplesLight={}),t>80?R.colorSamplesLight[e]!==!0&&(R.colorSamplesLight[e]=!0,r.addClass("s-c-p-light")):R.colorSamplesLight[e]!==!1&&(R.colorSamplesLight[e]=!1,r.removeClass("s-c-p-light"))}function P(r){var o=new SmallColorPicker.Color(r),e=o.hue(),t=H.square[0],l=t.width,a=t.getContext("2d");a.clearRect(0,0,l,l);for(var s=a.createImageData(l,l),i=s.data,n=0;l>n;n++)for(var c=0;l>c;c++){o.setHsv(e,Math.round(100*n/(l-1)),Math.round(100*c/(l-1)));var h=4*((l-c-1)*l+n);i[h]=o.r(),i[h+1]=o.g(),i[h+2]=o.b(),i[h+3]=255}a.putImageData(s,0,0)}function M(r){var o=r===t?N.hue():r,e=o/180*Math.PI,l=R.circleWidth,a=.025,s={transform:"rotate("+e+"rad)",left:l/2-l*Math.sin(-e+a)/2,top:l/2-l*Math.cos(-e+a)/2};H.circleMark.css(s),X=e-Math.PI/4,Y={},H.square.css({transform:"rotate("+X+"rad)"})}function b(r,o){var e=R.squareWidth,l=N.toHsv(),a=0,s=0;if(r!==t&&(O=r),o!==t&&(W=o),O!==t&&W!==t?(a+=O,s+=W):(a+=~~(l.s*e/100),s+=e-~~(l.v*e/100),a=Math.max(0,Math.min(e-1,a)),s=Math.max(0,Math.min(e-1,s))),!Y.rev){var i=R.squareWidth/2,n=R.elWidth/2;Y.rev=new SmallColorPicker.Transforms.Translate2D(-i,-i).chain(new SmallColorPicker.Transforms.Rotate2D(X)).chain(new SmallColorPicker.Transforms.Translate2D(n-3,n-3))}var c=Y.rev.apply([a,s]),h=H.squareMark[0].style;h.left=c[0]+"px",h.top=c[1]+"px",x()}function x(){var r=N.getPerceivedBrightness()>125;if(R.isSqMaskLight!==r){R.isSqMaskLight=r;var o=(new SmallColorPicker.Color).setHsv(0,0,r?40:90);H.squareMark[0].style.borderColor=o.toHex(),y(H.squareMark[0])}}function y(r){L.redrawBug&&(r.style.display="inline-block",r.offsetHeight,r.style.display="block")}function D(){M(),b()}function q(){H.el.hide()}var H,R,O,W,L,I=r.extend(!0,{},SmallColorPicker.defaults,e),N=new SmallColorPicker.Color(I.colors.colorNew),B=new SmallColorPicker.Color(I.colors.colorOld),X=0,Y={};this.toggle=function(){H&&H.el&&H.el.is(":visible")?this.hide():this.show()},this.show=function(){H||l(),P(N.toHex()),g(),w(),D(),H.el.show(),n()},this.hide=q,this.setColors=function(r,o){r!==t&&(N=new SmallColorPicker.Color(r)),o!==t&&(B=null===o?null:new SmallColorPicker.Color(o)),H&&H.el&&H.el.is(":visible")&&this.show()}}})(window.jQuery,document,window),function(r,o,e,t){"use strict";e.SmallColorPicker=e.SmallColorPicker||{},SmallColorPicker.Color=function(r){this.val=0,"number"==typeof r?this.val=r:"string"==typeof r&&(this.val=parseInt(r.substr(1),16))},SmallColorPicker.Color.prototype={constructor:SmallColorPicker.Color,r:function(r){return r!==t?(this.val=65535&this.val|r<<16,r):255&this.val>>16},g:function(r){return r!==t?(this.val=16711935&this.val|r<<8,r):255&this.val>>8},b:function(r){return r!==t?(this.val=16776960&this.val|r,r):255&this.val},toHex:function(){var r=("00000"+this.val.toString(16)).substr(-6);return"#"+r},toRgb:function(){return{r:this.r(),g:this.g(),b:this.b()}},toRgbStr:function(){return"rgb("+this.r()+","+this.g()+","+this.b()+")"},setRgb:function(r,o,e){return this.r(r),this.g(o),this.b(e),this},toHsv:function(){var r,o,e,t=this.r(),l=this.g(),a=this.b(),s=Math.min(t,l,a),i=Math.max(t,l,a),n=i-s;if(e=Math.floor(100*(i/255)),0==i)return{h:0,s:0,v:0};o=Math.floor(100*(n/i));var c=0==n?1:n;return r=t==i?(l-a)/c:l==i?2+(a-t)/c:4+(t-l)/c,r=Math.floor(60*r),0>r&&(r+=360),{h:r,s:o,v:e}},setHsv:function(r,o,e){if(r/=360,o/=100,e/=100,0==o){var t=Math.round(255*e);return this.r(t),this.g(t),this.b(t),this}var l,a,s,i=6*r,n=Math.floor(i),c=e*(1-o),h=e*(1-o*(i-n)),u=e*(1-o*(1-(i-n)));return 0==n?(l=e,a=u,s=c):1==n?(l=h,a=e,s=c):2==n?(l=c,a=e,s=u):3==n?(l=c,a=h,s=e):4==n?(l=u,a=c,s=e):(l=e,a=c,s=h),this.r(Math.round(255*l)),this.g(Math.round(255*a)),this.b(Math.round(255*s)),this},hue:function(r){if(r!==t){var o=this.toHsv();return this.setHsv(r,o.s,o.v),this}return this.toHsv().h},getPerceivedBrightness:function(){var r=this.toRgb();return Math.sqrt(.241*r.r*r.r+.691*r.g*r.g+.068*r.b*r.b)}}}(window.jQuery,document,window),function(r,o,e){"use strict";e.SmallColorPicker=e.SmallColorPicker||{},SmallColorPicker.Transforms={},SmallColorPicker.Transforms.Transform2D=function(r){this.matrix=r,this.next=null},SmallColorPicker.Transforms.Transform2D.prototype={constructor:SmallColorPicker.Transforms.Transform2D,apply:function(r){var o=[this.matrix[0][0]*r[0]+this.matrix[0][1]*r[1]+this.matrix[0][2],this.matrix[1][0]*r[0]+this.matrix[1][1]*r[1]+this.matrix[1][2]];return this.next?this.next.apply(o):o},chain:function(r){return this.next?this.next.chain(r):this.next=r,this}},SmallColorPicker.Transforms.Translate2D=function(r,o){SmallColorPicker.Transforms.Transform2D.call(this,[[1,0,r],[0,1,o]])},SmallColorPicker.Transforms.Translate2D.prototype=new SmallColorPicker.Transforms.Transform2D,SmallColorPicker.Transforms.Translate2D.prototype.constructor=SmallColorPicker.Transforms.Translate2D,SmallColorPicker.Transforms.Rotate2D=function(r){var o=Math.cos(r),e=Math.sin(r);SmallColorPicker.Transforms.Transform2D.call(this,[[o,-e,0],[e,o,0]])},SmallColorPicker.Transforms.Rotate2D.prototype=new SmallColorPicker.Transforms.Transform2D,SmallColorPicker.Transforms.Rotate2D.prototype.constructor=SmallColorPicker.Transforms.Translate2D}(window.jQuery,document,window);