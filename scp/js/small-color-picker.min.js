/*! SmallColorPicker v0.1.0  | (c) 2013 Antelle | https://github.com/antelle/small-color-picker/blob/master/MIT-LICENSE.txt */
(function(r,e,o,t){"use strict";o.SmallColorPicker=o.SmallColorPicker||{},SmallColorPicker.defaults={placement:{position:"absolute",top:"0",left:"0",parent:null},colors:{colorOld:null,colorNew:"#ff0000"},texts:{ok:"OK",cancel:"Cancel"},behavior:{hideOnSelect:!0},events:{ok:null,cancel:null}},SmallColorPicker.CirclePicker=function(o){function a(){l(),s(),i(),c(),n()}function l(){I={redrawBug:-1!=navigator.userAgent.indexOf("Safari"),borderRadius:"borderRadius"in e.body.style}}function s(){if(!I.borderRadius)throw"Browser is not supported"}function i(){H={},H.el=r("<div></div>").appendTo(L.placement.parent||e.body).addClass("s-c-p").css({position:L.placement.position,left:L.placement.left,top:L.placement.top}),"static"==H.el.css("position")&&H.el.css("position","relative"),H.circle=r("<div></div>").appendTo(H.el).addClass("s-c-p-circle"),H.innerCircle=r("<div></div>").appendTo(H.circle).addClass("s-c-p-circle-inner"),H.circleMark=r("<div></div>").appendTo(H.circle).addClass("s-c-p-circle-mark"),H.square=r("<canvas></canvas>").appendTo(H.el).addClass("s-c-p-square"),H.squareMark=r("<div></div>").appendTo(H.el).addClass("s-c-p-square-mark"),H.square.attr({width:H.square.width(),height:H.square.height()}),H.colorOld=r("<div></div>").appendTo(H.el).addClass("s-c-p-color s-c-p-color-old"),H.colorNew=r("<div></div>").appendTo(H.el).addClass("s-c-p-color s-c-p-color-new"),H.sampleOld=r("<div></div>").appendTo(H.el).addClass("s-c-p-sample s-c-p-sample-old").text(L.texts.cancel),H.sampleNew=r("<div></div>").appendTo(H.el).addClass("s-c-p-sample s-c-p-sample-new").text(L.texts.ok)}function n(){R={globalSelectionMode:r(e.body).css("user-select"),squareWidth:H.square.width(),circleWidth:H.circle.width(),elWidth:H.el.width()}}function c(){H.circle.on("mousedown",h),H.square.on("mousedown",u).on("selectstart",function(r){r.preventDefault()}),H.sampleNew.click(function(){L.behavior.hideOnSelect&&(q(),B=N),L.events.ok&&L.events.ok(N.toHex())}),H.sampleOld.click(function(){L.behavior.hideOnSelect&&q(),L.events.cancel&&L.events.cancel(B.toHex())})}function h(o){o.preventDefault(),p(o.pageX,o.pageY),C(!1),r(e).on("mousemove",d).one("mouseup",f)}function u(o){o.preventDefault(),v(o.pageX,o.pageY),C(!1),r(e).on("mousemove",m).one("mouseup",f)}function d(r){p(r.pageX,r.pageY)}function m(r){v(r.pageX,r.pageY)}function f(){C(!0),r(e).off("mousemove",d).off("mousemove",m)}function p(r,e){var o=H.circle.offset(),t=k(r-o.left,e-o.top);N.hue(t);var a=(new SmallColorPicker.Color).setHsv(t,100,100);P(a.toHex()),w(),b(t),M()}function v(r,e){if(!Y.fw){var o=H.circle.offset(),t=R.circleWidth/2,a=R.squareWidth/2;Y.fw=new SmallColorPicker.Transforms.Translate2D(-o.left-t,-o.top-t).chain(new SmallColorPicker.Transforms.Rotate2D(-X)).chain(new SmallColorPicker.Transforms.Translate2D(a,a))}var l=Y.fw.apply([r,e]);r=Math.max(0,Math.min(R.squareWidth-1,l[0])),e=Math.max(0,Math.min(R.squareWidth-1,l[1])),N=g(r,e),w(),M(r,e)}function C(o){r(e.body).css({webkitUserSelect:o?R.globalSelectionMode:"none"})}function k(r,e){var o=R.circleWidth;r-=o/2,e-=o/2;var t=Math.atan2(r,e);return 180-360*(t/Math.PI/2)}function g(r,e){var o=H.square[0],t=o.getContext("2d"),a=t.getImageData(r,e,1,1).data;return(new SmallColorPicker.Color).setRgb(a[0],a[1],a[2])}function S(){H.colorOld[0].innerHTML=null===B?"":B.toHex(),T(H.sampleOld,null===B?new SmallColorPicker.Color(10066329):B,"old")}function w(){H.colorNew[0].innerHTML=N.toHex(),T(H.sampleNew,N,"new")}function T(r,e,o){var t=e.toHsv().v;r[0].style.backgroundColor=e.toHex(),R.colorSamplesLight||(R.colorSamplesLight={}),t>80?R.colorSamplesLight[o]!==!0&&(R.colorSamplesLight[o]=!0,r.addClass("s-c-p-light")):R.colorSamplesLight[o]!==!1&&(R.colorSamplesLight[o]=!1,r.removeClass("s-c-p-light"))}function P(r){var e=new SmallColorPicker.Color(r),o=e.hue(),t=H.square[0],a=t.width,l=t.getContext("2d");l.clearRect(0,0,a,a);for(var s=l.createImageData(a,a),i=s.data,n=0;a>n;n++)for(var c=0;a>c;c++){e.setHsv(o,Math.round(100*n/(a-1)),Math.round(100*c/(a-1)));var h=4*((a-c-1)*a+n);i[h]=e.r(),i[h+1]=e.g(),i[h+2]=e.b(),i[h+3]=255}l.putImageData(s,0,0)}function b(r){var e=r===t?N.hue():r,o=e/180*Math.PI,a=R.circleWidth,l=.025,s={transform:"rotate("+o+"rad)",left:a/2-a*Math.sin(-o+l)/2,top:a/2-a*Math.cos(-o+l)/2};H.circleMark.css(s),X=o-Math.PI/4,Y={},H.square.css({transform:"rotate("+X+"rad)"})}function M(r,e){var o=R.squareWidth,a=N.toHsv(),l=0,s=0;if(r!==t&&(O=r),e!==t&&(W=e),O!==t&&W!==t?(l+=O,s+=W):(l+=~~(a.s*o/100),s+=o-~~(a.v*o/100),l=Math.max(0,Math.min(o-1,l)),s=Math.max(0,Math.min(o-1,s))),!Y.rev){var i=R.squareWidth/2,n=R.elWidth/2;Y.rev=new SmallColorPicker.Transforms.Translate2D(-i,-i).chain(new SmallColorPicker.Transforms.Rotate2D(X)).chain(new SmallColorPicker.Transforms.Translate2D(n-3,n-3))}var c=Y.rev.apply([l,s]),h=H.squareMark[0].style;h.left=c[0]+"px",h.top=c[1]+"px",x()}function x(){var r=N.getPerceivedBrightness()>125;if(R.isSqMaskLight!==r){R.isSqMaskLight=r;var e=(new SmallColorPicker.Color).setHsv(0,0,r?40:90);H.squareMark[0].style.borderColor=e.toHex(),y(H.squareMark[0])}}function y(r){I.redrawBug&&(r.style.display="inline-block",r.offsetHeight,r.style.display="block")}function D(){b(),M()}function q(){H.el.hide()}var H,R,O,W,I,L=r.extend(!0,{},SmallColorPicker.defaults,o),N=new SmallColorPicker.Color(L.colors.colorNew),B=new SmallColorPicker.Color(L.colors.colorOld),X=0,Y={};this.toggle=function(){H&&H.el&&H.el.is(":visible")?this.hide():this.show()},this.show=function(){H||a(),P(N.toHex()),S(),w(),D(),H.el.show(),n()},this.hide=q,this.setColors=function(r,e){r!==t&&(N=new SmallColorPicker.Color(r)),e!==t&&(B=null===e?null:new SmallColorPicker.Color(e)),H&&H.el&&H.el.is(":visible")&&this.show()}}})(window.jQuery,document,window),function(r,e,o,t){"use strict";o.SmallColorPicker=o.SmallColorPicker||{},SmallColorPicker.Color=function(r){if(this.val=0,"number"==typeof r)this.val=r;else if("string"==typeof r)if("#"===r.charAt(0))this.val=parseInt(r.substr(1),16);else{var e=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)/g.exec(r);this.setRgb(parseInt(e[1]),parseInt(e[2]),parseInt(e[3]))}},SmallColorPicker.Color.prototype={constructor:SmallColorPicker.Color,r:function(r){return r!==t?(this.val=65535&this.val|r<<16,r):255&this.val>>16},g:function(r){return r!==t?(this.val=16711935&this.val|r<<8,r):255&this.val>>8},b:function(r){return r!==t?(this.val=16776960&this.val|r,r):255&this.val},toHex:function(){var r=("00000"+this.val.toString(16)).substr(-6);return"#"+r},toRgb:function(){return{r:this.r(),g:this.g(),b:this.b()}},toRgbStr:function(){return"rgb("+this.r()+","+this.g()+","+this.b()+")"},setRgb:function(r,e,o){return this.r(r),this.g(e),this.b(o),this},toHsv:function(){var r,e,o,t=this.r(),a=this.g(),l=this.b(),s=Math.min(t,a,l),i=Math.max(t,a,l),n=i-s;if(o=Math.floor(100*(i/255)),0==i)return{h:0,s:0,v:0};e=Math.floor(100*(n/i));var c=0==n?1:n;return r=t==i?(a-l)/c:a==i?2+(l-t)/c:4+(t-a)/c,r=Math.floor(60*r),0>r&&(r+=360),{h:r,s:e,v:o}},setHsv:function(r,e,o){if(r/=360,e/=100,o/=100,0==e){var t=Math.round(255*o);return this.r(t),this.g(t),this.b(t),this}var a,l,s,i=6*r,n=Math.floor(i),c=o*(1-e),h=o*(1-e*(i-n)),u=o*(1-e*(1-(i-n)));return 0==n?(a=o,l=u,s=c):1==n?(a=h,l=o,s=c):2==n?(a=c,l=o,s=u):3==n?(a=c,l=h,s=o):4==n?(a=u,l=c,s=o):(a=o,l=c,s=h),this.r(Math.round(255*a)),this.g(Math.round(255*l)),this.b(Math.round(255*s)),this},hue:function(r){if(r!==t){var e=this.toHsv();return this.setHsv(r,e.s,e.v),this}return this.toHsv().h},getPerceivedBrightness:function(){var r=this.toRgb();return Math.sqrt(.241*r.r*r.r+.691*r.g*r.g+.068*r.b*r.b)}}}(window.jQuery,document,window),function(r,e,o){"use strict";o.SmallColorPicker=o.SmallColorPicker||{},SmallColorPicker.Transforms={},SmallColorPicker.Transforms.Transform2D=function(r){this.matrix=r,this.next=null},SmallColorPicker.Transforms.Transform2D.prototype={constructor:SmallColorPicker.Transforms.Transform2D,apply:function(r){var e=[this.matrix[0][0]*r[0]+this.matrix[0][1]*r[1]+this.matrix[0][2],this.matrix[1][0]*r[0]+this.matrix[1][1]*r[1]+this.matrix[1][2]];return this.next?this.next.apply(e):e},chain:function(r){return this.next?this.next.chain(r):this.next=r,this}},SmallColorPicker.Transforms.Translate2D=function(r,e){SmallColorPicker.Transforms.Transform2D.call(this,[[1,0,r],[0,1,e]])},SmallColorPicker.Transforms.Translate2D.prototype=new SmallColorPicker.Transforms.Transform2D,SmallColorPicker.Transforms.Translate2D.prototype.constructor=SmallColorPicker.Transforms.Translate2D,SmallColorPicker.Transforms.Rotate2D=function(r){var e=Math.cos(r),o=Math.sin(r);SmallColorPicker.Transforms.Transform2D.call(this,[[e,-o,0],[o,e,0]])},SmallColorPicker.Transforms.Rotate2D.prototype=new SmallColorPicker.Transforms.Transform2D,SmallColorPicker.Transforms.Rotate2D.prototype.constructor=SmallColorPicker.Transforms.Translate2D}(window.jQuery,document,window);